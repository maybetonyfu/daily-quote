#!/usr/bin/env bash
set -e

cd $(dirname $(realpath ${0}))

source config

git config --global user.email ${github_user_email}
git config --global user.name ${github_user_name}

mkdir ${HOME}/.ssh
touch ${HOME}/.ssh/config
cat <<EOF | tee ${HOME}/.ssh/config >&2 
Host github.com
    StrictHostKeyChecking no
EOF

rsyslogd
cron
touch /var/log/cron.log
tail -F /var/log/syslog /var/log/cron.log

if [[ ${commit_on_workday} -gt 0 ]]; then
    workday_frequency=$((24/${commit_on_workday}))
    echo ${workday_frequency}
    workday_job="* */${workday_frequency} * * 1-5 $(pwd)/updater 2>&1"
    cat < (crontab -l) |grep -v "${workday_job}" < (echo "${workday_job}")
fi

if [[ ${commit_on_weekend} -gt 0 ]]; then
    weekend_frequency=$((24/${commit_on_weekend}))
    echo ${weekend_frequency}
    weekend_job="* */${weekend_frequency} * * 0,6 $(pwd)/updater 2>&1"
    cat < (crontab -l) |grep -v "${weekend_job}" < (echo "${weekend_job}")
fi
